// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model ScoringMetric {
  id          BigInt @id @default(autoincrement())
  metricName  String
  metricValue String
  score       Int
}

model Employee {
  id        BigInt     @id @default(autoincrement())
  clerkId   String     @unique
  name      String
  avatarUrl String?
  position  String
  email     String     @unique
  phone     String?
  customers Customer[]
}

model PastOperation {
  id            BigInt    @id @default(autoincrement())
  customerId    BigInt
  description   String
  operationDate DateTime?
  customer      Customer  @relation(fields: [customerId], references: [id])
}

model Customer {
  cardiacIssuesScore     Int?
  diabeticConditionScore Int?
  hypertensionScore      Int?
  step                   Int?
  bmiScore               Int?
  smokeScore             Int?
  jobScore               Int?
  addressScore           Int?
  ageScore               Int?
  employeeIdScore        Int?
  insuranceSumScore      Int?
  durationScore          Int?
  premiumScore           Int?
  statusScore            Int?
  genderScore            Int?
  decisiveFactorScore    Int?
  trafficLightScore      Int?
  requestDateScore       Int?
  id                     BigInt             @id @default(autoincrement())
  name                   String?
  address                String?
  birthdate              DateTime?
  smoking                Boolean?
  bmi                    Float?
  job                    String?
  employeeId             BigInt?
  insuranceSum           Float?
  duration               Int?
  premium                Float?
  status                 Status?            @default(draft)
  requestDate            DateTime           @default(now())
  email                  String?            @unique
  gender                 Gender?
  decisiveFactor         DecisiveFactor?
  idDocument             String[]
  trafficLightColor      TrafficLightColor?
  documents              Document[]
  employee               Employee?          @relation(fields: [employeeId], references: [id])
  pastOperation          PastOperation[]
  medicalHistory         MedicalHistory?
}

model Document {
  id         BigInt   @id @default(autoincrement())
  customer   Customer @relation(fields: [customerId], references: [id])
  customerId BigInt
  fileUrl    String
  uploadDate DateTime @default(now())
  title      String
}

model MedicalHistory {
  id         BigInt   @id @default(autoincrement())
  customerId BigInt   @unique
  customer   Customer @relation(fields: [customerId], references: [id])

  hasChronicIllnesses  Boolean @default(false)
  chronicIllnessesInfo String?

  wasHospitalized     Boolean @default(false)
  hospitalizationInfo String?

  hasSeriousIllnesses  Boolean @default(false)
  seriousIllnessesInfo String?

  takesMedication Boolean @default(false)
  medicationInfo  String?
}

enum Status {
  draft
  waiting_for_approval
  requesting_documents
  accepted
  rejected
  accepted_with_conditions
}

enum Gender {
  male
  female
}

enum DecisiveFactor {
  score
  healthCheck
}

enum TrafficLightColor {
  green
  orange
  red
}

model RiskThreshold {
  id        Int   @id @default(autoincrement())
  greenMax  Float // Max score for Green category
  orangeMax Float // Max score for Orange category
  // Anything above orangeMax will automatically be categorized as Red
}

enum AttributeName {
  AGE
  BMI
  SMOKING
  JOB
  BIRTHDATE
  INSURANCE_SUM
  DURATION
  GENDER
}
